# .NETå­¦ä¹ 

å®˜æ–¹æ–‡æ¡£ï¼š[.NETæ–‡æ¡£](https://learn.microsoft.com/zh-cn/dotnet/fundamentals/)   [ä¸‹è½½.NET](https://dotnet.microsoft.com/zh-cn/download)   [æ•™ç¨‹æ–‡æ¡£](https://learn.microsoft.com/zh-cn/training/paths/build-dotnet-applications-csharp/)   [NuGet æ–‡æ¡£](https://learn.microsoft.com/zh-cn/nuget/)   [.NET CLI æ–‡æ¡£](https://learn.microsoft.com/zh-cn/dotnet/core/tools/)

### ä¸€äº›æ¦‚å¿µ

å­—å¤šï¼Œä¸æƒ³çœ‹çš„å¯ä»¥è·³è¿‡ã€‚

`API`ï¼šApplication Programming Interfaceï¼Œåº”ç”¨ç¨‹åºç¼–ç¨‹æ¥å£ï¼Œç®€å•ç†è§£å°±æ˜¯ç»™ç¨‹åºå‘˜æä¾›çš„å·¥å…·ï¼Œä»¥ä¾¿è½»æ¾å®Œæˆæƒ³è¦çš„åŠŸèƒ½ã€‚

`.NET`ï¼šç”± Microsoft åˆ›å»ºçš„**è·¨å¹³å°å¼€æº**å¼€å‘äººå‘˜**å¹³å°**ï¼Œç”¨äºç”Ÿæˆè®¸å¤šä¸åŒç±»å‹çš„åº”ç”¨ç¨‹åºã€‚æä¾›ä¸€ç»„æ ‡å‡†çš„**åŸºç±»åº“å’Œ API**ï¼Œå¯ä½¿ç”¨**C#ã€F#ã€Visual Basic ç¼–ç¨‹è¯­è¨€**è¿›è¡Œç¼–ç¨‹ã€‚

`ASP.NET`ï¼šç”± Microsoft åˆ›å»ºçš„å¼€æ”¾æºä»£ç  Web **æ¡†æ¶**ï¼ŒåŠ©ä½ ä½¿ç”¨ .NET ç”Ÿæˆç°ä»£ Web åº”ç”¨å’ŒæœåŠ¡ã€‚                        ASP.NET ä¸º .NET å¹³å°æ·»åŠ äº†ä»¥ä¸‹å†…å®¹:                        

- **ç”¨äºå¤„ç† C# æˆ– F# ä¸­ Web è¯·æ±‚çš„åŸºç¡€æ¡†æ¶**
- **ç”¨äºä½¿ç”¨ C# æ„å»ºåŠ¨æ€ç½‘é¡µçš„ç½‘é¡µæ¨¡æ¿åŒ–è¯­æ³•**ï¼Œç§°ä¸º Razorã€‚
- **é€šç”¨ Web æ¨¡å¼çš„åº“**ï¼Œä¾‹å¦‚æ¨¡å‹-è§†å›¾-æ§åˆ¶å™¨ (MVC)
- **èº«ä»½éªŒè¯ç³»ç»Ÿ**åŒ…æ‹¬ç”¨äºå¤„ç†ç™»å½•åçš„åº“ã€æ•°æ®åº“ã€æ¨¡æ¿é¡µé¢ï¼ŒåŒ…æ‹¬ä½¿ç”¨ Googleã€Twitter ç­‰è¿›è¡Œå¤šé‡èº«ä»½éªŒè¯å’Œå¤–éƒ¨èº«ä»½éªŒè¯ã€‚
- **ç¼–è¾‘å™¨æ‰©å±•**æä¾›äº†è¯­æ³•çªå‡ºæ˜¾ç¤ºã€ä»£ç å®Œæˆå’Œå…¶ä»–ä¸“é—¨ç”¨äºå¼€å‘ç½‘é¡µçš„åŠŸèƒ½

`ASP.NET Core`ï¼šASP.NET çš„å¼€æºå’Œè·¨å¹³å°ç‰ˆæœ¬ã€‚

`Web API`ï¼šæµè§ˆå™¨æä¾›çš„ä¸€å¥—æ“ä½œ**æµè§ˆå™¨åŠŸèƒ½**å’Œ**é¡µé¢å…ƒç´ **çš„æ¥å£ã€‚

`HTTP`ï¼šè¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼ˆHyper Text Transfer Protocolï¼‰æ˜¯ä¸€ä¸ªç®€å•çš„è¯·æ±‚-å“åº”åè®®ï¼ŒåŸºäº B/S æ¶æ„è¿›è¡Œé€šä¿¡ï¼Œå®ƒæŒ‡å®šäº†å®¢æˆ·ç«¯å¯èƒ½å‘é€ç»™æœåŠ¡å™¨ä»€ä¹ˆæ ·çš„æ¶ˆæ¯ä»¥åŠå¾—åˆ°ä»€ä¹ˆæ ·çš„å“åº”ã€‚

`HTTPS`ï¼šHyper Text Transfer Protocol Secureï¼Œæ˜¯ä»¥å®‰å…¨ä¸ºç›®æ ‡çš„ HTTP é€šé“ï¼Œåœ¨ HTTP çš„åŸºç¡€ä¸Šé€šè¿‡ä¼ è¾“åŠ å¯†å’Œèº«ä»½è®¤è¯ä¿è¯äº†ä¼ è¾“è¿‡ç¨‹çš„å®‰å…¨æ€§ã€‚

`localhost`ï¼šæœ¬åœ°ä¸»æœºï¼Œæ˜¯ç»™å›è·¯ç½‘ç»œæ¥å£çš„ä¸€ä¸ªæ ‡å‡†ä¸»æœºåï¼Œç›¸å¯¹åº”çš„IPåœ°å€ä¸º127.0.0.1ï¼ˆIPv4ï¼‰å’Œ[::1]ï¼ˆIPv6ï¼‰ã€‚

## VSCode åˆ›å»ºç¤ºä¾‹ .NET é¡¹ç›®å¹¶ä½¿ç”¨ä¾èµ–é¡¹

### åˆ›å»ºç¤ºä¾‹ .NET é¡¹ç›®

è¿™é‡Œä½¿ç”¨ `.NET7.0 SDK` å’Œ `Visual Studio Code`ï¼ˆå®‰è£… C# æ‹“å±•ï¼‰

è¿è¡Œä»¥ä¸‹å‘½ä»¤ç¡®ä¿å·²ç»å®‰è£….NET7.0ï¼š

```
dotnet --list-sdks
```

å¾—åˆ°è¾“å‡ºï¼š

```
7.0.203 [C:\Program Files\dotnet\sdk]
```

åˆ›å»ºåä¸º `DotNetDependencies` çš„æ–°æ–‡ä»¶å¤¹ï¼Œåœ¨ç»ˆç«¯çª—å£ä¸­è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š

```
dotnet new console -f net7.0
```

æ­¤å‘½ä»¤ä¼šåœ¨æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ª `Program.cs` æ–‡ä»¶ï¼ˆå†…é™„å·²ç¼–å†™çš„åŸºæœ¬â€œHello Worldâ€ç¨‹åºï¼‰ï¼Œè¿˜å°†åˆ›å»ºä¸€ä¸ªåä¸º `DotNetDependencies.csproj` çš„ C# é¡¹ç›®æ–‡ä»¶ã€‚

<img src="./assets/image-20230504195535181.png" alt="image-20230504195535181" style="zoom:50%;" /><img src="./assets/image-20230504195635587.png" alt="image-20230504195635587" style="zoom:50%;" />

åœ¨ç»ˆç«¯çª—å£ä¸­ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥è¿è¡Œç¨‹åºï¼š

```
dotnet run
```

### å®‰è£…å’Œä½¿ç”¨ä¾èµ–é¡¹

è¦æŸ¥æ‰¾å·²ç»å®‰è£…çš„ä¾èµ–é¡¹ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```
dotnet list package
```

é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£… `Humanizer` åº“ï¼ˆå¯ä»¥ä½¿ç”¨ `--version` å®‰è£…æŒ‡å®šç‰ˆæœ¬ï¼‰ï¼š

```
dotnet add package Humanizer
```

æ‰“å¼€ `DotNetDependencies.csproj` æ–‡ä»¶å¯ä»¥æ‰¾åˆ° `ItemGroup` éƒ¨åˆ†ï¼š

```xml
<ItemGroup>
    <PackageReference Include="Humanizer" Version="2.14.1" />
</ItemGroup>
```

é‡å†™ `Program.cs` æ–‡ä»¶ï¼š

```c#
using Humanizer;

static void HumanizeQuantities()
{
    Console.WriteLine("case".ToQuantity(0));
    Console.WriteLine("case".ToQuantity(1));
    Console.WriteLine("case".ToQuantity(5));
}

static void HumanizeDates()
{
    Console.WriteLine(DateTime.UtcNow.AddHours(-24).Humanize());
    Console.WriteLine(DateTime.UtcNow.AddHours(-2).Humanize());
    Console.WriteLine(TimeSpan.FromDays(1).Humanize());
    Console.WriteLine(TimeSpan.FromDays(16).Humanize());
}

Console.WriteLine("Quantities:");
HumanizeQuantities();

Console.WriteLine("\nDate/Time Manipulation:");
HumanizeDates();
```

è¿è¡Œå¾—åˆ°å¦‚ä¸‹è¾“å‡ºï¼š

```
Quantities:
0 cases
1 case 
5 cases

Date/Time Manipulation:
æ˜¨å¤©
2 å°æ—¶å‰
1 å¤©
2 å‘¨
```

è¯´æ˜ä¾èµ–é¡¹å·²ç»æ­£ç¡®å®‰è£…å¹¶ä½¿ç”¨ã€‚

### ä½¿ç”¨ VSCode è°ƒè¯•

è°ƒè¯•æ§åˆ¶å°ä¸æ¥å—æ­£åœ¨è¿è¡Œçš„ç¨‹åºçš„ç»ˆç«¯è¾“å…¥ï¼Œè‹¥è¦åœ¨è°ƒè¯•æ—¶å¤„ç†ç»ˆç«¯è¾“å…¥ï¼Œå¯ä»¥ä½¿ç”¨é›†æˆç»ˆç«¯ï¼ˆ`Visual Studio Code` çª—å£ä¹‹ä¸€ï¼‰æˆ–å¤–éƒ¨ç»ˆç«¯ã€‚ è¿™é‡Œä½¿ç”¨é›†æˆç»ˆç«¯ï¼š

æ‰“å¼€ `.vscode/launch.json` å¹¶æ›´æ”¹ `console` è®¾ç½®ã€‚

ä»

```json
"console": "internalConsole",
```

åˆ°

```json
"console": "integratedTerminal",
```

#### æ¡ä»¶è·Ÿè¸ª

é™¤äº†ç®€å•çš„ `Write` å’Œ `WriteLine` æ–¹æ³•ä¹‹å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ `WriteIf` å’Œ `WriteLineIf` æ·»åŠ æ¡ä»¶

```c#
Debug.WriteLineIf(count == 0, "The count is 0 and this may cause an exception.");
```

ç­‰åŒäº

```c#
if(count == 0)  
    Debug.WriteLine("The count is 0 and this may cause an exception.");
```

#### æ–­è¨€`Assert`è¯­å¥

å¯ä»¥ä½¿ç”¨ä½äº `System.Diagnostics` å‘½åç©ºé—´ä¸­çš„ `Debug` æˆ– `Trace` çš„ `Assert` æ–¹æ³•ã€‚ ç¨‹åºçš„å‘è¡Œç‰ˆä¸­ä¸åŒ…å« `Debug` ç±»æ–¹æ³•ï¼Œå› æ­¤å®ƒä»¬ä¸å¢å¤§å‘è¡Œä»£ç çš„å¤§å°ï¼Œä¹Ÿä¸ä¼šå‡æ…¢å‘è¡Œä»£ç çš„é€Ÿåº¦ã€‚

```c#
// If n2 is 5 continue, else break.
Debug.Assert(n2 == 5, "The return value is not 5 and it should be.");
return n == 0 ? n1 : n2;
```

- è°ƒè¯•æ—¶æ–­è¨€å¤±è´¥ï¼Œè°ƒè¯•å™¨å°†åœæ­¢åº”ç”¨ç¨‹åºï¼Œå¹¶å°†æ¶ˆæ¯è¾“å‡ºåˆ°è°ƒè¯•æ§åˆ¶å°ã€‚
- è¿è¡Œæ—¶ä¼šåœ¨æ–­è¨€å¤±è´¥åä¸­æ­¢ï¼Œå¹¶ä¸”å·²å°†ä¿¡æ¯è®°å½•åˆ°åº”ç”¨ç¨‹åºè¾“å‡ºã€‚
- åœ¨ `Release` é…ç½®ä¸­è¿è¡Œåº”ç”¨ç¨‹åºï¼š

```
dotnet run --configuration Release
```

ç”±äºä¸å†å¤„äº `Debug` é…ç½®ä¸­ï¼Œåº”ç”¨ç¨‹åºæˆåŠŸè¿è¡Œåˆ°å®Œæˆã€‚

## æ–‡ä»¶å’Œç›®å½•æ“ä½œ

å¦‚æœå¯¹`C#`æ–‡ä»¶å’Œç›®å½•æ“ä½œè¶³å¤Ÿç†Ÿæ‚‰ï¼Œå¯ä»¥è·³è¿‡æ­¤éƒ¨åˆ†ã€‚

### ä½¿ç”¨ Directory æŸ¥çœ‹æ–‡ä»¶ç³»ç»Ÿ

`System.IO.Directory`ç±»å…¬å¼€ç”¨äºåˆ›å»ºã€ç§»åŠ¨ä»¥åŠæšä¸¾ç›®å½•å’Œå­ç›®å½•çš„é™æ€æ–¹æ³•ã€‚ç°æœ‰ç›®å½•å¦‚ä¸‹ï¼š

```
ğŸ“‚ stores
    ğŸ“„ sales.json
    ğŸ“„ totals.txt
    ğŸ“‚ 201
       ğŸ“„ sales.json
       ğŸ“„ salestotals.json
       ğŸ“„ inventory.txt
    ğŸ“‚ 202
```

#### åˆ—å‡ºç›®å½•ä¸­æ‰€æœ‰æ–‡ä»¶

å¯ä»¥ä½¿ç”¨ `Directory.EnumerateFiles` å‡½æ•°

```c#
IEnumerable<string> files = Directory.EnumerateFiles("stores");

foreach (var file in files)
{
    Console.WriteLine(file);
}

// Outputs:
// stores/totals.txt
// stores/sales.json
```

#### åˆ—å‡ºæ‰€æœ‰ç›®å½•

ä½¿ç”¨ `Directory.EnumerateDirectories` å‡½æ•°

```c#
IEnumerable<string> listOfDirectories = Directory.EnumerateDirectories("stores");

foreach (var dir in listOfDirectories) {
    Console.WriteLine(dir);
}

// Outputs:
// stores/201
// stores/202
```

#### æœç´¢æ¨¡å¼æ–‡ä»¶å’Œç›®å½•

`Directory.EnumerateDirectories` å’Œ `Directory.EnumerateFiles` å‡½æ•°éƒ½å…·æœ‰ä¸€ä¸ªé‡è½½ï¼Œæ¥å—ç”¨äºæŒ‡å®šæœç´¢æ¨¡å¼æ–‡ä»¶å’Œç›®å½•å¿…é¡»åŒ¹é…çš„å‚æ•°ã€‚

å®ƒä»¬è¿˜å…·æœ‰å¦ä¸€ä¸ªé‡è½½ï¼Œè¯¥é‡è½½æ¥å—ç”¨äºæŒ‡ç¤ºæ˜¯å¦ä»¥é€’å½’æ–¹å¼éå†æŒ‡å®šçš„æ–‡ä»¶å¤¹åŠå…¶æ‰€æœ‰å­æ–‡ä»¶å¤¹çš„å‚æ•°ã€‚

```c#
// Find all *.txt files in the stores folder and its subfolders
IEnumerable<string> allFilesInAllFolders = Directory.EnumerateFiles("stores", "*.txt", SearchOption.AllDirectories);

foreach (var file in allFilesInAllFolders)
{
    Console.WriteLine(file);
}

// Outputs:
// stores/totals.txt
// stores/201/inventory.txt
```

### ä½¿ç”¨ .NET æ“ä½œæ–‡ä»¶è·¯å¾„

#### ç›®å½•

##### ç¡®å®šå½“å‰ç›®å½•

ä½¿ç”¨`Directory.GetCurrentDirectory` æ–¹æ³•

```c#
Console.WriteLine(Directory.GetCurrentDirectory());
//if in folder "201"
//Output: stores\201 
```

##### åˆ›å»ºç›®å½•

ä½¿ç”¨ `Directory.CreateDirectory` æ–¹æ³•ï¼Œå¦‚æœç›®æ ‡æ–‡ä»¶å¤¹ä¸å­˜åœ¨åˆ™è‡ªåŠ¨åˆ›å»ºï¼ˆä¹Ÿå¯ä»¥ç”¨ `Directory.Exists` æ–¹æ³•ç¡®è®¤ç›®å½•æ˜¯å¦å­˜åœ¨ï¼‰

```c#
Directory.CreateDirectory(Path.Combine(Directory.GetCurrentDirectory(), "stores","201","newDir"));
//stores/201 -> stores/201/newDir
```

##### ç‰¹æ®Šç›®å½•

`.NET` å¯åœ¨ä»»ä½•ä½ç½®ï¼š `Windows`ã€`macOS`ã€`Linux` ï¼Œç”šè‡³ `iOS` å’Œ `Android` ä¸Šè¿è¡Œã€‚`System.Environment.SpecialFolder` æšä¸¾æŒ‡å®šç”¨äºæ£€ç´¢ç‰¹æ®Šç³»ç»Ÿæ–‡ä»¶å¤¹è·¯å¾„çš„å¸¸é‡ã€‚

ä»¥ä¸‹ä»£ç å°†è¿”å›ä»»ä½•æ“ä½œç³»ç»Ÿçš„è·¯å¾„ï¼Œè¯¥è·¯å¾„ç­‰æ•ˆäº `Windows\MyDocuments` æ–‡ä»¶å¤¹è·¯å¾„æˆ–ç”¨æˆ·çš„ä¸»ç›®å½•è·¯å¾„ï¼ˆå³ä½¿æ­¤ä»£ç åœ¨ `Linux` ä¸Šè¿è¡Œä¹Ÿæ˜¯å¦‚æ­¤ï¼‰ï¼š

```c#
string docPath = Environment.GetFolderPath(Environment.SpecialFolder.MyDocuments);
```

#### è·¯å¾„

`.NET` åŒ…å«ä¸€ä¸ª `Path` ç±»ï¼Œä¸“ç”¨äºå¤„ç†è·¯å¾„ï¼Œä½äº `System.IO` å‘½åç©ºé—´ä¸­ã€‚

##### ç”Ÿæˆè·¯å¾„

ä¸åŒçš„æ“ä½œç³»ç»Ÿä½¿ç”¨ä¸åŒçš„å­—ç¬¦æ¥åˆ†éš”ç›®å½•çº§åˆ«ã€‚å¦‚`Windows` ä½¿ç”¨åæ–œæ  (`stores\201`)ï¼Œè€Œ `macOS` ä½¿ç”¨æ­£æ–œæ  (`stores/201`)ã€‚

`Path` ç±»åŒ…å« `DirectorySeparatorChar` å­—æ®µï¼Œå¯å¸®åŠ©ä½ ä½¿ç”¨æ­£ç¡®çš„å­—ç¬¦ã€‚

å½“ä½ éœ€è¦æ‰‹åŠ¨ç”Ÿæˆè·¯å¾„æ—¶ï¼Œ`.NET` ä¼šè‡ªåŠ¨å°†è¯¥å­—æ®µè§£é‡Šä¸ºé€‚ç”¨äºæ“ä½œç³»ç»Ÿçš„åˆ†éš”ç¬¦ã€‚

```c#
Console.WriteLine($"stores{Path.DirectorySeparatorChar}201");
// Outputs:
// stores\201 on Windows
// stores/201 on macOS
```

##### è¿æ¥è·¯å¾„

ä½¿ç”¨ `Path.Combine` å‡½æ•°

```c#
Console.WriteLine(Path.Combine("stores","201")); 
// outputs: stores/201
```

##### ç¡®å®šæ–‡ä»¶æ‹“å±•å

ä½¿ç”¨ `Path.GetExtension` å‡½æ•°

```c#
Console.WriteLine(Path.GetExtension("sales.json")); 
// outputs: .json
```

#### æ–‡ä»¶

##### åˆ›å»ºæ–‡ä»¶

ä½¿ç”¨ `File.WriteAllText` æ–¹æ³•ï¼Œå¦‚æœæ­¤æ–‡ä»¶å·²å­˜åœ¨ï¼Œåˆ™ä¼šå°†å…¶è¦†ç›–ã€‚ä¾‹å¦‚ï¼Œæ­¤ä»£ç åˆ›å»ºä¸€ä¸ªåä¸º `greeting.txt` çš„æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«æ–‡æœ¬ â€œHello World!â€ï¼š

```c#
File.WriteAllText(Path.Combine(Directory.GetCurrentDirectory(), "greeting.txt"), "Hello World!");
```

##### è¯»å†™æ–‡ä»¶

- é€šè¿‡ `File` ç±»ä¸Šçš„ `ReadAllText` æ–¹æ³•è¯»å–æ–‡ä»¶ï¼Œè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²

```c#
File.ReadAllText($"stores{Path.DirectorySeparatorChar}201{Path.DirectorySeparatorChar}sales.json");
```

- ä½¿ç”¨ç›¸åŒçš„ `WriteAllText` æ–¹æ³•ï¼Œä¼ å…¥è¦å†™å…¥çš„æ•°æ®

```c#
var data = JsonConvert.DeserializeObject<SalesTotal>(salesJson);
File.WriteAllText($"salesTotalDir{Path.DirectorySeparatorChar}totals.txt", data.Total.ToString());

// totals.txt
// 22385.32
```

- å¯ä»¥ä½¿ç”¨ `File.AppendAllText` æ–¹æ³•è¿½åŠ æ•°æ®

```c#
var data = JsonConvert.DeserializeObject<SalesTotal>(salesJson);
File.AppendAllText($"salesTotalDir{Path.DirectorySeparatorChar}totals.txt", $"{data.Total}{Environment.NewLine}");

// totals.txt
// 22385.32
// 22385.32
```

#### å…¶ä»–

- å¯ä»¥ä½¿ç”¨ `DirectoryInfo` æˆ– `FileInfo` ç±»è·å–å…³äºç›®å½•æˆ–æ–‡ä»¶çš„æœ€å®Œæ•´ä¿¡æ¯ã€‚
- è¿˜æœ‰å¾ˆå¤šå…¶ä»–æ–‡ä»¶å’Œç›®å½•æ“ä½œçš„ç±»å’Œæ–¹æ³•ï¼Œå‚è€ƒ`C#`æ•™ç¨‹

## ä½¿ç”¨ ASP.NET Core æ§åˆ¶å™¨åˆ›å»º Web API

å½“ä½ æµè§ˆç½‘é¡µæ—¶ï¼Œ`Web` æœåŠ¡å™¨å°†ä½¿ç”¨ `HTML`ã€`CSS` å’Œ `JavaScript` ä¸æµè§ˆå™¨é€šä¿¡ã€‚ å¦‚æœä½ ä¸é¡µé¢è¿›è¡ŒæŸç§äº¤äº’ï¼Œä¾‹å¦‚æäº¤ç™»å½•çª—ä½“æˆ–é€‰æ‹©è´­ä¹°æŒ‰é’®ï¼Œæµè§ˆå™¨ä¼šå°†ä¿¡æ¯å‘é€å› `Web` æœåŠ¡å™¨ã€‚

åŒæ ·çš„ï¼Œ`API` å®¢æˆ·ç«¯é€šè¿‡ `HTTP` ä¸æœåŠ¡å™¨é€šä¿¡ï¼Œä¸¤è€…éƒ½ä½¿ç”¨ `JSON` æˆ– `XML` ç­‰æ•°æ®æ ¼å¼æ¥äº¤æ¢ä¿¡æ¯ã€‚ `API` é€šå¸¸ä¾›å•é¡µåº”ç”¨ç¨‹åº (`SPA`) ç”¨äºåœ¨ `Web` æµè§ˆå™¨ä¸­æ‰§è¡Œå¤§éƒ¨åˆ†ç”¨æˆ·ç•Œé¢é€»è¾‘ã€‚ ä¸ `Web` æœåŠ¡å™¨çš„é€šä¿¡ä¸»è¦æ˜¯é€šè¿‡ `Web API` è¿›è¡Œçš„ã€‚

### RESTï¼šç”¨äºä½¿ç”¨ HTTP ç”Ÿæˆ API çš„å¸¸è§æ¨¡å¼

è¡¨è¿°æ€§çŠ¶æ€è½¬ç§» (`REST`) æ˜¯ä¸€ç§ç”¨äºç”Ÿæˆ `Web` æœåŠ¡çš„ä½“ç³»ç»“æ„æ ·å¼ã€‚ `REST` è¯·æ±‚æ˜¯é€šè¿‡ `HTTP` å‘å‡ºçš„ã€‚ å®ƒä»¬ä½¿ç”¨ `Web` æµè§ˆå™¨ç”¨äºæ£€ç´¢ç½‘é¡µå’Œå°†æ•°æ®å‘é€åˆ°æœåŠ¡å™¨çš„ç›¸åŒ `HTTP` è°“è¯ã€‚ è°“è¯å¦‚ä¸‹ï¼š

- `GET`ï¼šä» `Web` æœåŠ¡æ£€ç´¢æ•°æ®ã€‚
- `POST`ï¼šåœ¨ `Web` æœåŠ¡ä¸Šåˆ›å»ºæ–°çš„æ•°æ®é¡¹ã€‚
- `PUT`ï¼šæ›´æ–° `Web` æœåŠ¡ä¸Šçš„æ•°æ®é¡¹ã€‚
- `PATCH`ï¼šé€šè¿‡æè¿°æœ‰å…³å¦‚ä½•ä¿®æ”¹é¡¹çš„ä¸€ç»„è¯´æ˜ï¼Œæ›´æ–° `Web` æœåŠ¡ä¸Šçš„æ•°æ®é¡¹ã€‚ æœ¬æ¨¡å—ä¸­çš„ç¤ºä¾‹åº”ç”¨ç¨‹åºä¸ä½¿ç”¨æ­¤è°“è¯ã€‚
- `DELETE`ï¼šåˆ é™¤ `Web` æœåŠ¡ä¸Šçš„æ•°æ®é¡¹ã€‚

éµå¾ª `REST` çš„ `Web` æœåŠ¡ `API` ç§°ä¸º `RESTful API`ã€‚ å®ƒä»¬é€šè¿‡ä»¥ä¸‹æ–¹æ³•è¿›è¡Œå®šä¹‰ï¼š

- ä¸€ä¸ªåŸº `URI`ï¼ˆç»Ÿä¸€èµ„æºæ ‡è¯†ç¬¦ï¼‰ã€‚
- `HTTP` æ–¹æ³•ï¼Œå¦‚ `GET`ã€`POST`ã€`PUT`ã€`PATCH` æˆ– `DELETE`ã€‚
- æ•°æ®çš„åª’ä½“ç±»å‹ï¼Œä¾‹å¦‚ `JSON` æˆ– `XML`ã€‚

### åˆ›å»º Web API é¡¹ç›®

#### åŸºç¡€æ“ä½œ

æ–°å»ºæ–‡ä»¶å¤¹ï¼Œåœ¨ç»ˆç«¯ä¸­è¾“å…¥ï¼š

```
dotnet new webapi -f net7.0
```

æ­¤å‘½ä»¤ä½¿ç”¨åˆ«åä¸º *`webapi`* çš„ `ASP.NET Core` é¡¹ç›®æ¨¡æ¿æ¥åˆ›å»ºåŸºäº `C#` çš„ `Web API` é¡¹ç›®çš„åŸºæ¶ï¼Œå°†åˆ›å»ºä½¿ç”¨æ§åˆ¶å™¨çš„åŸºæœ¬ `Web API` é¡¹ç›®çš„æ–‡ä»¶ï¼Œä»¥åŠä¸€ä¸ª `.csproj` ï¼ˆå‘½åä¸æ–‡ä»¶å¤¹ç›¸åŒï¼Œæˆ‘è¿™é‡Œå‘½åä¸º`WebAPI`ï¼‰çš„ `C#` é¡¹ç›®æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å°†è¿”å›å¤©æ°”é¢„æŠ¥åˆ—è¡¨ã€‚ å¦‚æœé‡åˆ°é”™è¯¯ï¼Œè¯·ç¡®ä¿å·²å®‰è£… `.NET 7.0 SDK`

> é»˜è®¤ä½¿ç”¨ `https` ä¿æŠ¤ Web API é¡¹ç›®ã€‚ å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·[é…ç½® ASP.NET Core HTTPS å¼€å‘è¯ä¹¦](https://learn.microsoft.com/zh-cn/aspnet/core/security/enforcing-ssl#trust-the-aspnet-core-https-development-certificate-on-windows-and-macos)ã€‚

è¿è¡Œå‘½ä»¤ï¼š

```
dotnet run
```

> ä¸Šè¿°å‘½ä»¤ï¼š
>
> - åœ¨å½“å‰ç›®å½•ä¸­æ‰¾åˆ°é¡¹ç›®æ–‡ä»¶ã€‚
> - æ£€ç´¢å¹¶å®‰è£…æ­¤é¡¹ç›®æ‰€éœ€çš„ä»»ä½•é¡¹ç›®ä¾èµ–é¡¹ã€‚
> - ç¼–è¯‘é¡¹ç›®ä»£ç ã€‚
> - ä½¿ç”¨ ASP.NET Core Kestrel Web æœåŠ¡å™¨å°† Web API æ‰˜ç®¡åœ¨ HTTP å’Œ HTTPS ç»ˆç»“ç‚¹ä¸­ã€‚
>
> åˆ›å»ºé¡¹ç›®æ—¶ï¼Œå°†ä¸º HTTP é€‰æ‹© 5000 åˆ° 5300 ç«¯å£ï¼Œä¸º HTTPS é€‰æ‹© 7000 åˆ° 7300 ç«¯å£ã€‚ é€šè¿‡ç¼–è¾‘é¡¹ç›®çš„ launchSettings.json æ–‡ä»¶ï¼Œå¯ä»¥è½»æ¾æ›´æ”¹å¼€å‘è¿‡ç¨‹ä¸­ä½¿ç”¨çš„ç«¯å£ã€‚

ä½ å°†è·å¾—å¦‚ä¸‹è¾“å‡ºï¼ŒæŒ‡ç¤ºåº”ç”¨æ­£åœ¨è¿è¡Œï¼š

```
æ­£åœ¨ç”Ÿæˆ...
info: Microsoft.Hosting.Lifetime[14]
      Now listening on: http://localhost:5046
info: Microsoft.Hosting.Lifetime[0]
      Application started. Press Ctrl+C to shut down.
info: Microsoft.Hosting.Lifetime[0]
      Hosting environment: Development
info: Microsoft.Hosting.Lifetime[0]
      Content root path: D:\repos\WebAPI
```

##### é€€å‡ºWeb API

å¦‚æœæƒ³è¦é€€å‡º`Web API`ï¼Œå¯ä»¥åœ¨æ§åˆ¶å°ä¸­æŒ‰`ctrl+c`

##### æŸ¥çœ‹

å¦‚æœä½ æ˜¯åœ¨è‡ªå·±çš„è®¡ç®—æœºä¸Šè¿è¡Œæ­¤åº”ç”¨ï¼Œå¯ä»¥å°†æµè§ˆå™¨æŒ‡å‘è¾“å‡ºä¸­æ˜¾ç¤ºçš„ `HTTPS` é“¾æ¥ï¼ˆåœ¨ä¸Šä¾‹ä¸­ä¸º `https://localhost:5046`ï¼‰ä»¥æŸ¥çœ‹ç”Ÿæˆçš„é¡µé¢ã€‚ è¯·è®°ä½æ­¤ç«¯å£ï¼Œå› ä¸ºä½ åœ¨ä½¿ç”¨ `{PORT}` çš„æ¨¡å—ä¸­å°†ä¸€ç›´ä½¿ç”¨å®ƒã€‚

ä¸ºäº†å¾—åˆ°å¤©æ°”é¢„æŠ¥æ•°æ®ï¼Œæ‰“å¼€ Web æµè§ˆå™¨è¾“å…¥ï¼š

```
https://localhost:{PORT}/weatherforecast
```

ä¼šå¾—åˆ°è¿™ä¸ªï¼ˆä»¥ `Chrome` ä¸ºä¾‹ï¼‰ï¼š

<img src="./assets/image-20230509223753627.png" alt="image-20230509223753627" style="zoom: 50%;" />

è§£å†³çš„è¯ä¹Ÿå¾ˆç®€å•ï¼ŒæŠŠ`https`æ”¹æˆ`http`å°±è¡Œäº†

å‡ºç°æ­¤é—®é¢˜çš„åŸå› æ˜¯å¼€å‘è¯ä¹¦ä¸å—ä¿¡ä»»ï¼Œå¯ä»¥ä½¿ç”¨ `dotnet dev-certs https --trust`[é…ç½®ç³»ç»Ÿä»¥ä¿¡ä»»å¼€å‘è¯ä¹¦](https://learn.microsoft.com/zh-cn/aspnet/core/security/enforcing-ssl#trust-the-aspnet-core-https-development-certificate-on-windows-and-macos)ã€‚ï¼ˆä½†æ˜¯æˆ‘æŒ‰ç…§ä»–ç»™çš„æ–¹æ³•åšäº†è¿˜æ˜¯æ‰“ä¸å¼€ï¼Œç´¢æ€§åé¢éƒ½ç”¨`http`äº†ï¼‰

#### .NET HTTP REPL å‘½ä»¤è¡Œå·¥å…·

1. æ‰“å¼€æ–°çš„ç»ˆç«¯ï¼ˆ`â€œTerminalâ€->"New Terminal"`æˆ–`ctrl+shift+Ë‹`æˆ–ç‚¹å‡»ä¸‹æ–¹`Terminal`å³ä¾§çš„åŠ å·ï¼‰è¿è¡Œï¼š

   ```
   dotnet tool install -g Microsoft.dotnet-httprepl
   ```

   è¯¥å‘½ä»¤å°†å®‰è£… .NET HTTP REPL å‘½ä»¤è¡Œå·¥å…·ï¼Œä½ å°†ä½¿ç”¨å®ƒå‘ Web API å‘å‡º HTTP è¯·æ±‚

2. è¿è¡Œå‘½ä»¤è¿æ¥åˆ°Web APIï¼š

   ```
   httprepl https://localhost:{PORT}
   ```

   æˆ–è€…åœ¨`HttpRepl`è¿è¡Œæ—¶è¾“å…¥ï¼š

   ```
   connect https://localhost:{PORT}
   ```

3. è‹¥è¦åœ¨`HttpRepl`è¿è¡Œæ—¶é€€å‡ºï¼Œå‘½ä»¤ä¸ºï¼š

   ```
   exit
   ```

4. å¦‚æœé‡åˆ°`Unable to find an OpenAPI description`è­¦å‘Šï¼Œæœ€æœ‰å¯èƒ½çš„åŸå› æ˜¯å¼€å‘è¯ä¹¦ä¸å—ä¿¡ä»»ã€‚ `HttpRepl` éœ€è¦ä¿¡ä»»è¿æ¥ã€‚å¯ä»¥å°†ä¸Šè¿°å‘½ä»¤çš„`https`æ”¹ä¸º`http` ã€‚

5. é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤æµè§ˆå¯ç”¨çš„ç»ˆç»“ç‚¹ï¼Œè¯¥å‘½ä»¤å°†æ£€æµ‹è¿æ¥çš„ç»ˆç»“ç‚¹ä¸Šæ‰€æœ‰å¯ç”¨çš„ APIã€‚

   > ç»ˆç»“ç‚¹æ˜¯ç”¨æ¥å‘é€æˆ–æ¥æ”¶æ¶ˆæ¯ï¼ˆæˆ–åŒæ—¶æ‰§è¡Œè¿™ä¸¤ç§æ“ä½œï¼‰çš„æ„é€  ï¼ŒåŒ…æ‹¬ä¸€ä¸ªå®šä¹‰æ¶ˆæ¯å¯ä»¥å‘é€åˆ°çš„ç›®çš„åœ°ä½ç½®ï¼ˆåœ°å€ï¼‰ã€ä¸€ä¸ªæè¿°æ¶ˆæ¯è¯¥å¦‚ä½•å‘é€çš„é€šä¿¡æœºåˆ¶è§„èŒƒï¼ˆç»‘å®šï¼‰ï¼Œä»¥åŠå¯ä»¥åœ¨è¯¥ä½ç½®å‘é€æˆ–æ¥æ”¶çš„ä¸€ç»„æ¶ˆæ¯çš„å®šä¹‰ï¼ˆæœåŠ¡åå®šï¼‰

   ```
   ls
   ```

   è¾“å‡ºï¼š

   ```
   .                 []    
   WeatherForecast   [GET] 
   ```

6. è¿è¡Œä»¥ä¸‹å‘½ä»¤ä»¥è½¬åˆ° `WeatherForecast` ç»ˆç»“ç‚¹ï¼ˆä¸æ–‡ä»¶æ“ä½œæ–¹å¼ç›¸åŒï¼Œå¦‚åŒæ ·å¯ä»¥ä½¿ç”¨`../`è¿”å›ä¸Šçº§ç›®å½•ï¼‰ï¼š

   ```
   cd WeatherForecast
   ```

7. åœ¨ `HttpRepl` ä¸­å‘å‡º `GET` è¯·æ±‚ï¼š

   ```
   get
   ```

   è¾“å‡ºå¦‚ä¸‹ï¼Œç±»ä¼¼äºè½¬åˆ°æµè§ˆå™¨ä¸­çš„ç»ˆç»“ç‚¹ï¼š

   ```
   http://localhost:5046/WeatherForecast> get
   HTTP/1.1 200 OK
   Content-Type: application/json; charset=utf-8
   Date: Thu, 11 May 2023 07:21:51 GMT
   Server: Kestrel
   Transfer-Encoding: chunked
   
   [
     {
       "date": "2023-05-12",
       "temperatureC": -7,
       "temperatureF": 20,
       "summary": "Hot"
     },
     //...
   ]
   ```

#### ASP.NET Core Web API æ§åˆ¶å™¨

åœ¨`WeatherForecast.cs`ä¸­å¯ä»¥æŸ¥çœ‹ç¤ºä¾‹ä»£ç ï¼Œäº†è§£å¦‚ä½•ç”¨ `ControllerBase` åŸºç±»å’Œå‡ ä¸ª .NET å±æ€§æ¥ç”Ÿæˆæ­£å¸¸å·¥ä½œçš„ Web APIã€‚ äº†è§£è¿™äº›æ¦‚å¿µåï¼Œä¾¿å¯ä»¥ç¼–å†™è‡ªå·±çš„ç±»äº†ã€‚

##### åŸºç±»ï¼š`ControllerBase`

æ§åˆ¶å™¨æ˜¯ä¸€ä¸ªå…¬å…±ç±»ï¼Œå…·æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªç§°ä¸ºâ€œæ“ä½œâ€çš„å…¬å…±æ–¹æ³•ã€‚ æŒ‰ç…§æƒ¯ä¾‹ï¼Œæ§åˆ¶å™¨æ”¾åœ¨é¡¹ç›®æ ¹ç›®å½•çš„ Controllers ç›®å½•ä¸­ã€‚ç¤ºä¾‹çš„`WeatherForecastController`ç±»ç»§æ‰¿è‡ª `ControllerBase` åŸºç±»ã€‚

æ“ä½œé€šè¿‡è·¯ç”±è¢«å…¬å¼€ä¸º HTTP ç»ˆç»“ç‚¹ã€‚ å› æ­¤ï¼Œå¯¹ `http://localhost:{PORT}/weatherforecast` çš„ HTTP `GET` è¯·æ±‚å°†æ‰§è¡Œ `WeatherForecastController` ç±»çš„ `Get()` æ–¹æ³•ã€‚

##### API æ§åˆ¶å™¨ç±»å±æ€§

```c#
[ApiController]
[Route("[controller]")]
public class WeatherForecastController : ControllerBase
```

- `[ApiController]` å¯ç”¨[å›ºå®šè¡Œä¸º](https://learn.microsoft.com/zh-cn/aspnet/core/web-api/#apicontroller-attribute-1)ï¼Œä½¿ç”Ÿæˆ Web API æ›´åŠ å®¹æ˜“ã€‚æ­¤å±æ€§åŒ…æ‹¬å¤šä¸ªç‰¹å®šäº API çš„å›ºå®šè¡Œä¸ºï¼Œä¾‹å¦‚è‡ªåŠ¨å¤„ç†é”™è¯¯çš„ HTTP è¯·æ±‚ã€‚
- `[Route]` å®šä¹‰è·¯ç”±æ¨¡å¼ `[controller]`ã€‚ `[controller]` ä»¤ç‰Œå°†æ›¿æ¢ä¸ºæ§åˆ¶å™¨çš„åç§°ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼Œæ—  Controller åç¼€ï¼‰ã€‚ æ­¤æ§åˆ¶å™¨å¤„ç†å¯¹ `http://localhost:{PORT}/weatherforecast` çš„è¯·æ±‚ã€‚

### æ·»åŠ ä¸€ä¸ªç®€å•çš„ Hello World æ§åˆ¶å™¨

åœ¨`Controllers`æ–‡ä»¶å¤¹ä¸­æ–°å»ºä¸€ä¸ª`HelloWorld.cs`æ–‡ä»¶ã€‚ç›®å½•åç§° `Controllers` æ˜¯ä¸€ç§çº¦å®šã€‚ ç›®å½•åç§°æ¥è‡ª Web API ä½¿ç”¨çš„æ¨¡å‹-è§†å›¾-æ§åˆ¶å™¨ä½“ç³»ç»“æ„ã€‚

å†™å…¥å¦‚ä¸‹å†…å®¹ï¼ŒåŒ…æ‹¬ä¸€ä¸ªæ´¾ç”Ÿè‡ª`ControllerBase`çš„ç±»ã€å‰æ–‡æåˆ°çš„ä¸¤ä¸ªæ ‡å‡†å±æ€§`[ApiController]`å’Œ`[Route("[controller]")]`ï¼Œä»¥åŠä¸€ä¸ª`GET`è°“è¯ã€‚

```c#
using Microsoft.AspNetCore.Mvc;

namespace HelloWorld.Controllers;
[ApiController]
[Route("[controller]")]

public class HelloWorldController : ControllerBase
{
    public HelloWorldController(){}

    [HttpGet]
    public ActionResult<string> Get()
    {
        return "Hello World!";
    }
}
```

æŒ‰ä¹‹å‰çš„æ–¹æ³•å¯åŠ¨ Web API å¹¶è¿æ¥åï¼Œå¯ä»¥åœ¨`HttpRepl`ä¸­å‘é€`GET`è¯·æ±‚ï¼Œè¿”å›å¦‚ä¸‹ï¼š

```
http://localhost:5046/HelloWorld> get
HTTP/1.1 200 OK
Content-Type: text/plain; charset=utf-8
Date: Thu, 11 May 2023 08:30:35 GMT
Server: Kestrel
Transfer-Encoding: chunked

Hello World!


```

å¦‚æœä½¿ç”¨æµè§ˆå™¨ï¼ˆæ­¤å¤„ä»¥`Firefox`ä¸ºä¾‹ï¼‰æ‰“å¼€ï¼Œå¯ä»¥çœ‹åˆ°ï¼š

<img src="./assets/image-20230511191429352.png" alt="image-20230511191429352" style="zoom:50%;" />

### æ·»åŠ æ•°æ®å­˜å‚¨

#### åˆ›å»ºæ¨¡å‹ï¼ˆç±»ï¼‰

å‡è®¾è¦ä¸ºé€‰è¯¾ç³»ç»Ÿå¼€å‘ä¸€ä¸ª`RESTful`æœåŠ¡ï¼Œä½œä¸º Web å’Œç§»åŠ¨åº”ç”¨ç¨‹åºçš„å¿…å¤‡ç»„ä»¶ã€‚åœ¨ä¸ºé€‰è¯¾å®ç° Web API ä¹‹å‰ï¼Œéœ€è¦æ·»åŠ ä¸€ä¸ªæ•°æ®å­˜å‚¨ä¾›æ“ä½œã€‚

åˆ›å»º `Models` æ–‡ä»¶å¤¹ç”¨äºå­˜å‚¨æ¨¡å‹ï¼ˆæ‰‹åŠ¨æˆ–ç”¨`mkdir Models`å‘½ä»¤ï¼‰ã€‚ç›®å½•åç§° `Models` æ˜¯ä¸€ç§çº¦å®šï¼Œæ¥è‡ª Web API ä½¿ç”¨çš„æ¨¡å‹-è§†å›¾-æ§åˆ¶å™¨ä½“ç³»ç»“æ„ã€‚

åœ¨å…¶ä¸­æ·»åŠ ä¸€ä¸ª`Course.cs`æ–‡ä»¶å¹¶æ·»åŠ ä»£ç ï¼Œä»¥å®šä¹‰è¯¾ç¨‹ç±»`Course`ã€‚

```c#
namespace WebAPI.Models;

public class Course
{
    public int Id { get; set; }
    public string? Name { get; set; }
    public bool IsCompulsory { get; set; }
    public int Credit { get; set; }
}
```

#### æ·»åŠ æ•°æ®æœåŠ¡

åˆ›å»º`Services`æ–‡ä»¶å¤¹ï¼Œåœ¨å…¶ä¸­æ·»åŠ `CourseService.cs`æ–‡ä»¶ï¼Œéšåæ·»åŠ ä»£ç ç”¨äºåˆ›å»ºæœåŠ¡ã€‚

```c#
using WebAPI.Models;

namespace WebAPI.Services;

public static class CourseService
{
    static List<Course> Courses { get; }
    static int nextId = 3;
    static CourseService()
    {
        Courses = new List<Course>{
            new Course { Id = 1, Name = "Math", IsCompulsory = true, Credit = 4},
            new Course { Id = 2, Name = "Physics", IsCompulsory = false, Credit = 2},
        };
    }

    public static List<Course> GetAll() => Courses;

    public static Course? Get(int id) => Courses.FirstOrDefault(p => p.Id == id);

    public static void Add(Course course){
        course.Id = nextId++;
        Courses.Add(course);
    }

    public static void Delete(int id){
        var course = Get(id);
        if(course is null)  return;
        Courses.Remove(course);
    }

    public static void Update(Course course){
        var index = Courses.FindIndex(p => p.Id == course.Id);
        if(index == -1) return;
        Courses[index] = course;
    }
}
```

é»˜è®¤æƒ…å†µä¸‹ï¼Œæ­¤æœåŠ¡æä¾›ä¸€ä¸ªç®€å•çš„å†…å­˜ä¸­æ•°æ®ç¼“å­˜æœåŠ¡ï¼Œé»˜è®¤æ„é€ ä¸¤ä¸ªè¯¾ç¨‹ã€‚æ­¤å¤–è¿˜æœ‰å¢åˆ æ”¹æŸ¥çš„æœåŠ¡ã€‚

è¯¥æ•°æ®å­˜å‚¨æ˜¯ä¸€ä¸ªç®€å•çš„æœ¬åœ°å†…å­˜ä¸­ç¼“å­˜æœåŠ¡ã€‚ åœ¨å®é™…åº”ç”¨ç¨‹åºä¸­ï¼Œå¯ä»¥è€ƒè™‘å°†æ•°æ®åº“ï¼ˆä¾‹å¦‚ SQL Serverï¼‰ä¸ Entity Framework Core ç»“åˆä½¿ç”¨ã€‚

#### ç”Ÿæˆ Web API é¡¹ç›®

è¿è¡Œå‘½ä»¤

```
dotnet build
```

### CRUDæ“ä½œ

HTTP è°“è¯çš„æ ‡å‡†åŒ–ä½¿ç”¨æ–¹å¼ï¼Œä¹Ÿç§°ä¸ºåˆ›å»ºã€è¯»å–ã€æ›´æ–°ã€åˆ é™¤ (CRUD)ã€‚

å…ˆç”¨ä¸ä¸Šæ–‡ç”Ÿæˆ`HelloWorld`æ§åˆ¶å™¨ç±»ä¼¼çš„æ–¹å¼ç”Ÿæˆä¸€ä¸ª`CourseController`æ§åˆ¶å™¨ï¼Œä½äº`Controllers\CourseController.cs`ä¸­ã€‚

```c#
using WebAPI.Models;
using WebAPI.Services;
using Microsoft.AspNetCore.Mvc;

namespace WebAPI.Controllers;
[ApiController]
[Route("[controller]")]

public class CourseController : ControllerBase
{
    public CourseController() {}

    [HttpGet]
    public ActionResult<List<Course>> GetAll() =>
        CourseService.GetAll();

    [HttpGet("{id}")]
    public ActionResult<Course> Get(int id)
    {
        var course = CourseService.Get(id);
        if(course == null)  return NotFound();
        return course;
    }

    // POST action

    // PUT action

    // DELETE action

}
```

#### è¯»å–`GET`

- `[HttpGet]` å±æ€§è¡¨ç¤ºä»…å“åº” HTTP `GET` è°“è¯ã€‚è·¯ç”±é€»è¾‘å°† `[HttpGet]`ï¼ˆæ²¡æœ‰ `id`ï¼‰å’Œ `[HttpGet("{id}")]`ï¼ˆå…·æœ‰ `id`ï¼‰æ³¨å†Œä¸ºä¸¤ä¸ªä¸åŒçš„è·¯ç”±ï¼Œåˆ†åˆ«ä¸ºè¿”å›æ‰€æœ‰å’ŒæŒ‰`id`æŸ¥æ‰¾ã€‚
- è¿”å›ç±»å‹ä¸º `ActionResult` å®ä¾‹ã€‚ `ActionResult` ç±»å‹æ˜¯ ASP.NET Core ä¸­æ‰€æœ‰æ“ä½œç»“æœçš„åŸºç±»ã€‚
- è¦æ±‚ `course/` ä¹‹åçš„ URL æ®µä¸­åŒ…å« `id` å‚æ•°çš„å€¼ã€‚æ§åˆ¶å™¨çº§åˆ«çš„ `[Route]`å±æ€§å®šä¹‰äº†`/course`æ¨¡å¼ã€‚
- `ActionResult` å®ä¾‹æ˜ å°„åˆ°ä¸‹è¡¨ä¸­å¯¹åº”çš„ HTTP çŠ¶æ€ä»£ç ï¼š

| ASP.NET Core æ“ä½œç»“æœ | HTTP çŠ¶æ€ä»£ç  | è¯´æ˜                                                         |
| :-------------------- | :------------ | :----------------------------------------------------------- |
| `Ok` ä¸ºéšå¼           | 200           | å†…å­˜ä¸­ç¼“å­˜ä¸­å­˜åœ¨ä¸æ‰€æä¾›çš„ `id` å‚æ•°åŒ¹é…çš„äº§å“ã€‚ è¯¥äº§å“åŒ…å«åœ¨ç”± `accept` HTTP è¯·æ±‚æ ‡å¤´ä¸­æ‰€å®šä¹‰çš„åª’ä½“ç±»å‹ï¼ˆé»˜è®¤æƒ…å†µä¸‹ä¸º JSONï¼‰çš„å“åº”æ­£æ–‡ä¸­ã€‚ |
| `NotFound`            | 404           | å†…å­˜ä¸­ç¼“å­˜ä¸­ä¸å­˜åœ¨ä¸æ‰€æä¾›çš„ `id` å‚æ•°åŒ¹é…çš„äº§å“ã€‚           |

#### åˆ›å»º`POST`

å°†`// POST action`éƒ¨åˆ†æ›¿æ¢ä¸ºä»¥ä¸‹ä»£ç ï¼š

```c#
[HttpPost]
public IActionResult Create(Course course)
{
    CourseService.Add(course);
    return CreatedAtAction(nameof(Get), new {id = course.Id}, course);
}
```

- ä»…å“åº” HTTP `POST` è°“è¯

- `CreatedAtAction` æ–¹æ³•è°ƒç”¨ä¸­çš„ç¬¬ä¸€ä¸ªå‚æ•°è¡¨ç¤ºæ“ä½œåç§°ã€‚ `nameof` å…³é”®å­—ç”¨äºé¿å…å¯¹æ“ä½œåç§°è¿›è¡Œç¡¬ç¼–ç ã€‚ `CreatedAtAction` ä½¿ç”¨æ“ä½œåç§°æ¥ç”Ÿæˆ `location` HTTP å“åº”æ ‡å¤´ï¼Œè¯¥æ ‡å¤´åŒ…å«æ–°åˆ›å»ºçš„ URLï¼Œå¦‚ä¸Šä¸€ä¸ªå•å…ƒä¸­ä»‹ç»ã€‚

- ç”±äºæ§åˆ¶å™¨ä½¿ç”¨ `[ApiController]` å±æ€§è¿›è¡Œæ‰¹æ³¨ï¼Œå› æ­¤æ„å‘³ç€å°†åœ¨è¯·æ±‚æ­£æ–‡ä¸­æ‰¾åˆ° `Course` å‚æ•°ã€‚

- `IActionResult` å¯è®©å®¢æˆ·ç«¯çŸ¥é“è¯·æ±‚æ˜¯å¦æˆåŠŸï¼Œå¹¶æä¾›æ–°åˆ›å»ºçš„ IDã€‚ `IActionResult` é€šè¿‡ä½¿ç”¨æ ‡å‡† HTTP çŠ¶æ€ä»£ç æ¥å®Œæˆè¯¥æ“ä½œï¼Œå› æ­¤ï¼Œæ— è®ºå®¢æˆ·ç«¯ä½¿ç”¨å“ªç§è¯­è¨€æˆ–è€…åœ¨å“ªä¸ªå¹³å°ä¸Šè¿è¡Œï¼Œå®ƒéƒ½èƒ½è½»æ¾åœ°ä¸å®¢æˆ·ç«¯é›†æˆã€‚

| ASP.NET Core æ“ä½œç»“æœ | HTTP çŠ¶æ€ä»£ç  | è¯´æ˜                                                         |
| :-------------------- | :------------ | :----------------------------------------------------------- |
| `CreatedAtAction`     | 201           | å·²æ·»åŠ åˆ°å†…å­˜ä¸­ç¼“å­˜ã€‚ åŒ…å«åœ¨ç”± `accept` HTTP è¯·æ±‚æ ‡å¤´ä¸­æ‰€å®šä¹‰çš„åª’ä½“ç±»å‹ï¼ˆé»˜è®¤æƒ…å†µä¸‹ä¸º JSONï¼‰çš„å“åº”æ­£æ–‡ä¸­ã€‚ |
| `BadRequest` ä¸ºéšå¼   | 400           | è¯·æ±‚æ­£æ–‡çš„ `course` å¯¹è±¡æ— æ•ˆã€‚                               |

#### æ›´æ–°`PUT`

å°†`// PUT action`éƒ¨åˆ†æ›¿æ¢ä¸ºä»¥ä¸‹ä»£ç ï¼š

```c#
[HttpPut("{id}")]
public IActionResult Update(int id, Course course)
{
if (id != course.Id)  return BadRequest();
var existingCourse = CourseService.Get(id);
if (existingCourse is null) return NotFound();
CourseService.Update(course);
return NoContent();
}
```

- ä»…å“åº” HTTP `PUT` è°“è¯.
- è¦æ±‚ `course/` ä¹‹åçš„ URL æ®µä¸­åŒ…å« `id` å‚æ•°çš„å€¼ã€‚
- è¿”å› `IActionResult`ï¼Œå› ä¸ºåœ¨è¿è¡Œæ—¶ä¹‹å‰ï¼Œ`ActionResult` è¿”å›ç±»å‹æœªçŸ¥ã€‚ `BadRequest`ã€`NotFound` å’Œ `NoContent` æ–¹æ³•åˆ†åˆ«è¿”å› `BadRequestResult`ã€`NotFoundResult` å’Œ `NoContentResult` ç±»å‹ã€‚

| ASP.NET Core æ“ä½œç»“æœ | HTTP çŠ¶æ€ä»£ç  | è¯´æ˜                                       |
| :-------------------- | :------------ | :----------------------------------------- |
| `NoContent`           | 204           | å·²åœ¨å†…å­˜ä¸­ç¼“å­˜ä¸­æ›´æ–°ã€‚                     |
| `BadRequest`          | 400           | è¯·æ±‚æ­£æ–‡çš„ `Id` å€¼ä¸è·¯ç”±çš„ `id` å€¼ä¸åŒ¹é…ã€‚ |
| `BadRequest` ä¸ºéšå¼   | 400           | è¯·æ±‚æ­£æ–‡çš„ `Course` å¯¹è±¡æ— æ•ˆã€‚             |

#### åˆ é™¤`DELETE`

å°†`// DELETE action`éƒ¨åˆ†æ›¿æ¢ä¸ºä»¥ä¸‹ä»£ç ï¼š

```c#
[HttpDelete("{id}")]
public IActionResult Delete(int id)
{
    var course = CourseService.Get(id);
    if (course is null) return NotFound();
    CourseService.Delete(id);
    return NoContent();
}
```

- ä»…å“åº” HTTP `DELETE` è°“è¯.
- è¦æ±‚ `course/` ä¹‹åçš„ URL æ®µä¸­åŒ…å« `id` å‚æ•°çš„å€¼ã€‚

| ASP.NET Core æ“ä½œç»“æœ | HTTP çŠ¶æ€ä»£ç  | è¯´æ˜                                         |
| :-------------------- | :------------ | :------------------------------------------- |
| `NoContent`           | 204           | å·²ä»å†…å­˜ä¸­ç¼“å­˜ä¸­åˆ é™¤ã€‚                       |
| `NotFound`            | 404           | å†…å­˜ä¸­ç¼“å­˜ä¸­ä¸å­˜åœ¨ä¸æ‰€æä¾›çš„ `id` å‚æ•°åŒ¹é…ã€‚ |

#### ç”Ÿæˆå¹¶è¿è¡Œ

ä¿å­˜æ›´æ”¹åï¼ŒæŒ‰ç…§ä¹‹å‰çš„æ–¹å¼ç”Ÿæˆã€å¯åŠ¨ã€è¿æ¥ Web APIï¼Œé€æ¡è¿è¡Œä»¥ä¸‹å‘½ä»¤éªŒè¯æ‰€åšçš„æ›´æ”¹ï¼š

```
cd Course
ls
post -c "{"name":"DataBase","isCompulsory":true,"credit":4}"
put 3 -c "{"id":3, "name":"OOP","isCompulsory":true,"credit":2}"
get 3
delete 3
get
```

## ä½¿ç”¨ VS 

ä½¿ç”¨ VS è¿›è¡Œä¸Šè¿°æ­¥éª¤å¾ˆç®€å•ï¼Œå®‰è£… â€œASP.NET å’Œ Web å¼€å‘â€ å’Œ â€œ.NET æ¡Œé¢å¼€å‘â€

<img src="./assets/image-20230514173501379.png" alt="image-20230514173501379" style="zoom: 50%;" />

åœ¨æ–°å»ºé¡¹ç›®æ—¶é€‰æ‹©éœ€è¦çš„å³å¯

<img src="./assets/image-20230514173734612.png" alt="image-20230514173734612" style="zoom:50%;" />

å…¶ä»–éƒ¨åˆ†ä¸åœ¨ VSCode æ“ä½œå·®åˆ«ä¸å¤§ï¼ŒVS ä¸Šè¿è¡Œåä¼šå¸®ä½ è§£å†³`https`çš„é—®é¢˜ï¼Œä¸”ä¼šæ˜¾ç¤º`Swagger UI`é¡µé¢ï¼š

<img src="./assets/image-20230514174718559.png" alt="image-20230514174718559" style="zoom:50%;" />

è®¿é—® `https://localhost:7029/helloworld`å’Œ`https://localhost:7029/course`ï¼Œä¹Ÿèƒ½å¾—åˆ°é¢„æœŸçš„ç»“æœï¼š

<img src="./assets/image-20230514174906600.png" alt="image-20230514174906600" style="zoom:50%;" />
